# Dataset Uploader для TARGControl

## Описание

Это веб-приложение, созданное с использованием **Streamlit**, предназначено для автоматизации создания и отправки датасетов в систему TARGControl через API. Приложение позволяет загружать Excel-файлы с данными о продукции, локациях и навыках, проверять их корректность и отправлять в TARGControl для создания датасетов с дневными и ночными шаблонами.

## Основные функции

- Загрузка Excel-файла с данными о продукции, локациях и навыках.
- Проверка корректности структуры файла (наличие обязательных столбцов: `Продукция`, `Локация`).
- Валидация названий локаций и навыков на соответствие данным из API TARGControl.
- Настройка временных интервалов для дневных и ночных шаблонов (один или два шаблона).
- Автоматическое создание датасетов и их отправка через API TARGControl.
- Отображение прогресса обработки файла и сообщений об ошибках.

## Требования

Для работы приложения необходимо установить зависимости, перечисленные в файле `requirements.txt`. Основные зависимости включают:

- **Python**: 3.8+
- **Streamlit**: 1.46.1
- **Pandas**: 2.3.1
- **Requests**: 2.32.4
- **Openpyxl**: 3.1.5

Полный список зависимостей:

```
altair==5.5.0
attrs==25.3.0
blinker==1.9.0
cachetools==6.1.0
certifi==2025.7.9
charset-normalizer==3.4.2
click==8.2.1
colorama==0.4.6
et_xmlfile==2.0.0
gitdb==4.0.12
GitPython==3.1.44
idna==3.10
Jinja2==3.1.6
jsonschema==4.24.0
jsonschema-specifications==2025.4.1
MarkupSafe==3.0.2
narwhals==1.46.0
numpy==2.3.1
openpyxl==3.1.5
packaging==25.0
pandas==2.3.1
pillow==11.3.0
protobuf==6.31.1
pyarrow==20.0.0
pydeck==0.9.1
python-dateutil==2.9.0.post0
pytz==2025.2
referencing==0.36.2
requests==2.32.4
rpds-py==0.26.0
six==1.17.0
smmap==5.0.2
streamlit==1.46.1
tenacity==9.1.2
toml==0.10.2
tornado==6.5.1
typing_extensions==4.14.1
tzdata==2025.2
urllib3==2.5.0
watchdog==6.0.0
```

## Установка

1. Клонируйте репозиторий:

   ```bash
   git clone https://github.com/your-repository/dataset-uploader.git
   cd dataset-uploader
   ```
2. Создайте виртуальное окружение и активируйте его:

   ```bash
   python -m venv venv
   source venv/bin/activate  # Для Windows: venv\Scripts\activate
   ```
3. Установите зависимости:

   ```bash
   pip install -r requirements.txt
   ```
4. Запустите приложение:

   ```bash
   streamlit run app.py
   ```

## Использование

1. Запустите приложение с помощью команды выше.
2. Введите действительный API-токен TARGControl в соответствующее поле.
3. Загрузите Excel-файл с данными. Убедитесь, что файл соответствует структуре, описанной в инструкции приложения (см. раздел "Инструкция по созданию Excel-файла" в интерфейсе).
4. Выберите количество шаблонов (1 или 2) и задайте временные интервалы для дневного и (при необходимости) ночного шаблона.
5. Выберите метрику из доступных в TARGControl.
6. Нажмите кнопку "Обработать файл" для обработки и отправки данных.

### Структура Excel-файла

Файл должен содержать следующие столбцы:

- **Продукция**: Название продукта (например, "Продукт А").
- **Локация**: Название локации, точно совпадающее с данными в TARGControl (например, "Линия 1").
- **Описание**: Необязательное описание продукта (например, код номенклатуры).
- **Навыки**: Столбцы с названиями навыков из TARGControl (например, "Навык1", "Навык2"). Значения — целые числа или пустые ячейки.

Пример:

| Продукция | Локация | Описание | Навык1 | Навык2 |
| --- | --- | --- | --- | --- |
| Продукт А | Линия 1 | NOM12345 | 5 | 3 |
| Продукт Б | Линия 2 |  | 2 | 0 |

### Важные замечания

- Названия локаций и навыков в Excel-файле должны **точно** совпадать с данными в TARGControl.
- Время окончания дневного шаблона не должно быть позже времени начала ночного шаблона (при использовании двух шаблонов).
- Для работы приложения требуется доступ к API TARGControl (`cloud.targcontrol.com`).

## Ошибки и их устранение

- **Ошибка при чтении Excel-файла**: Убедитесь, что файл имеет формат `.xlsx` и содержит все обязательные столбцы.
- **Локация не найдена**: Проверьте, что названия локаций в файле совпадают с данными API (отображаются в интерфейсе приложения).
- **Ошибка API**: Убедитесь, что API-токен действителен и сервер TARGControl доступен.
- **Отсутствуют метрики или шаблоны**: Создайте необходимые метрики и шаблоны в веб-интерфейсе TARGControl.
